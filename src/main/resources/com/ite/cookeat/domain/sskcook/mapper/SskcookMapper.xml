<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ite.cookeat.domain.sskcook.mapper.SskcookMapper">

  <insert id="insertSskcook" parameterType="PostSskcookReq">
    <selectKey keyProperty="sskcookId" order="BEFORE" resultType="Integer">
      <![CDATA[
        SELECT sskcook_seq.nextval AS sskcookId FROM dual
      ]]>
    </selectKey>
    <![CDATA[
        INSERT INTO sskcook (sskcook_id, sskcook_url, member_id, title, recipe)
        VALUES (#{sskcookId}, #{sskcookUrl}, #{memberId}, #{title}, #{recipe})
    ]]>
  </insert>
  <insert id="insertIngredientSskcook" parameterType="PostIngredientReq">
    <![CDATA[
    INSERT INTO ingredient_sskcook (ingredient_id, sskcook_id, name, amount)
    VALUES (ingredient_sskcook_seq.nextval, #{sskcookId}, #{name}, #{amount})
    ]]>
  </insert>
  <insert id="insertHashtag" parameterType="PostHashtagReq">
    <![CDATA[
    INSERT INTO sskcook_hashtag (sskcook_hashtag_id, sskcook_id, hashtag_id)
    VALUES (sskcook_hashtag_seq.nextval, #{sskcookId}, #{hashtagId})
    ]]>
  </insert>
  <update id="updateSskcookCount" parameterType="Integer">
    <![CDATA[
    UPDATE member
    SET sskcook_count = (SELECT COUNT(*)
                         FROM sskcook
                         WHERE member_id = #{memberId}
                           AND STATUS = 'ACTIVE')
    WHERE member_id = #{memberId}
    ]]>
  </update>
</mapper>